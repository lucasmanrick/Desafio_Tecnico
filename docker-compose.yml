version: '3.8'
services:
postgres:
image: postgres:15
environment:
POSTGRES_DB: cryptotracker
POSTGRES_USER: crypto_user
POSTGRES_PASSWORD: secure_password
volumes:
- postgres_data:/var/lib/postgresql/data
ports:
- "5432:5432"
healthcheck:
test: ["CMD-SHELL", "pg_isready -U crypto_user"]
interval: 10s
timeout: 5s
retries: 5
redis:
image: redis:7-alpine
ports:
- "6379:6379"
healthcheck:
test: ["CMD", "redis-cli", "ping"]
interval: 10s
timeout: 3s
retries: 3
backend:
build: .
command: python manage.py runserver 0.0.0.0:8000
volumes:
- .:/app
ports:
- "8000:8000"
depends_on:
postgres:
condition: service_healthy
redis:
condition: service_healthy
env_file:
- .env
celery_worker:
build: .
command: celery -A core worker -l info --concurrency=2
volumes:
- .:/app
depends_on:
postgres:
condition: service_healthy
redis:
condition: service_healthy
env_file:
- .env
celery_beat:
build: .
command: celery -A core beat -l info --scheduler django_celery_beat.schedulers:DatabaseSvolumes:
- .:/app
depends_on:
postgres:
condition: service_healthy
redis:
condition: service_healthy
env_file:
- .env
volumes:
postgres_data: